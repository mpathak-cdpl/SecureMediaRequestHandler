<!--
  Purpose: Optional Sitecore configuration for SecureMediaRequestHandler

  Deployment: Place this file in App_Config/Include/SecureMedia/ folder in the client's Sitecore instance

  IMPORTANT ARCHITECTURE CHANGE:
  - Files are stored in Sitecore CONTENT TREE: /sitecore/content/home/data/SecureMedia/{State}/
  - Files are accessed via custom HTTP handler at: /api/securemedia/{state}/{filename}
  - NO media library usage
  - NO Sitecore pipeline processors needed
  - Custom HTTP handler registered in Web.config handles all authorization

  This config file is optional and can be used for future settings if needed.
-->
<configuration xmlns:patch="http://www.sitecore.net/xmlconfig/">
	<system.webServer>
		<handlers>
			<!-- 
        Register custom HTTP handler for secure media requests
        URL Pattern: /api/securemedia/*
        
        This handler will:
        1. Parse the URL to extract state and filename
        2. Validate user authentication and claims
        3. Retrieve file from Sitecore content item
        4. Stream file with no-cache headers
        5. Return 401/403/404 if validation fails
      -->
			<add name="SecureMediaHandler"
				 verb="GET"
				 path="api/securemedia/*"
				 type="SecureMediaRequestHandler.Handlers.SecureMediaHttpHandler, SecureMediaRequestHandler"
				 resourceType="Unspecified"
				 requireAccess="None"
				 preCondition="integratedMode" />
		</handlers>
	</system.webServer>
</configuration>
