<?xml version="1.0" encoding="utf-8"?>
<!--
  Purpose: Registers the SecureMediaHttpHandler to serve files from Sitecore content tree
  
  Deployment: Merge this into client's Web.config <system.webServer> section
  
  IMPORTANT: This is the ONLY IIS/Web.config change needed.
             Files are served from /sitecore/content/home/data/SecureMedia/ (NOT media library)
             URL pattern: /api/securemedia/{state}/{filename}
-->
<configuration>
  <system.webServer>
    <handlers>
      <!-- 
        Register custom HTTP handler for secure media requests
        URL Pattern: /api/securemedia/*
        
        This handler will:
        1. Parse the URL to extract state and filename
        2. Validate user authentication and claims
        3. Retrieve file from Sitecore content item
        4. Stream file with no-cache headers
        5. Return 401/403/404 if validation fails
      -->
      <add name="SecureMediaHandler" 
           verb="GET" 
           path="api/securemedia/*" 
           type="SecureMediaRequestHandler.Handlers.SecureMediaHttpHandler, SecureMediaRequestHandler" 
           resourceType="Unspecified" 
           requireAccess="None" 
           preCondition="integratedMode" />
    </handlers>
  </system.webServer>
</configuration>
